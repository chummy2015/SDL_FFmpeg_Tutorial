
#ifndef AUDIO_H
#define AUDIO_H

#include "PacketQueue.h"
extern "C"{

#include <libavformat/avformat.h>

}


/**
 * ????audio??????????????
 */
struct AudioState
{
	const uint32_t BUFFER_SIZE;// ?????????§³

	PacketQueue audioq;

	double audio_clock; // audio clock
	AVStream *stream; // audio stream

	uint8_t *audio_buff;       // ???????????????
	uint32_t audio_buff_size;  // buffer?§Φ??????
	uint32_t audio_buff_index; // buffer??¦Δ?????????index
	
	int stream_index;          // audio??index
	AVCodecContext *audio_ctx; // ???????avcodec_open2??

	AudioState();              //????????
	AudioState(AVCodecContext *audio_ctx, int audio_stream);
	
	~AudioState();

	/**
	* audio play
	*/
	bool audio_play();

	// get audio clock
	double get_audio_clock();
};

/**
 * ???υτ????audio???????????
 */
void audio_callback(void* userdata, Uint8 *stream, int len);

/**
 * ????Avpacket?§Φ??????????????
 */
int audio_decode_frame(AudioState *audio_state, uint8_t *audio_buf, int buf_size);


#endif